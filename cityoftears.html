<html>

<head>
  <title>City of Tears</title>
  <!--============================ VERTEX SHADER ============================-->
  <script id="shaderVertTexPhong" type="x-shader/x-vertex">
    #version 300 es
    precision mediump float;
    // Vertex shader for phong illumination model
    // Per vertex shading

    // Vertex Attributes
    in vec3 aVertexPosition; // in model coords
    in vec3 aNormal; // normals
    in vec2 aUV; // u-v coordinates

    // for object rotation
    uniform mat4 modelT;
    uniform mat4 viewT;
    uniform mat4 projT;
    uniform vec3 lightPosition; //

    // outputs
    out vec2 theUV; // pass uv's onto the fragment shader
    out vec3 N; //
    out vec3 L; //
    out vec3 V; //

    void main()
    {
      // All calculations will be done in camera space
      mat4 modelView = viewT * modelT;
      mat4 normalmatrix = transpose(inverse (modelView));
      
      vec3 vcam = (modelView * vec4(aVertexPosition, 1.0)).xyz;
      vec3 lcam = (viewT * vec4(lightPosition, 1.0)).xyz;
      vec3 ncam = (normalmatrix * vec4(aNormal, 1.0)).xyz;
      ncam = faceforward (ncam, vcam, ncam);
      
      // vectors to pass on to Fragment Shader
      N = normalize (ncam);
      L = normalize (lcam - vcam);
      V = -normalize (vcam);

      // pass uvs to fragment shader
      theUV = aUV;

      // transform vertex to clip space
      gl_Position = projT * viewT * modelT * vec4 (aVertexPosition, 1.0);
    }

    </script>


  <!--=========================== FRAGMENT SHADER ===========================-->
  <script id="shaderFragTexPhong" type="x-shader/x-fragment">
    #version 300 es

    // Fragment shader for phong illumination model
    // Per vertex shading

    precision lowp float;
        
    // uvs passed in from vertex shader
    in vec2 theUV;
    in vec3 N; //
    in vec3 L; //
    in vec3 V; //

    // the texture to use
    uniform sampler2D theTexture;
    uniform float ka; //
    uniform float kd; //
    uniform float ks; //
    uniform float ke; //
    uniform vec3 ambientLight; //
    uniform vec3 lightColor; //
    uniform vec3 specHighlightColor; //

    // Color that is the result of this shader
    out vec4 fragColor;

    void main(void) {
      // individual components
      vec3 R = normalize (reflect (-L, N));

      vec3 baseColor = texture(theTexture, theUV).xyz;
      float transparency = texture(theTexture, theUV).w;
             
      vec3 ambient = ka * ambientLight * baseColor;
      vec3 diffuse = kd * lightColor * baseColor * max (dot(L, N), 0.0);
      vec3 spec = ks * specHighlightColor * lightColor * pow (max(dot(R, V), 0.0), ke);
      
      // final color
      fragColor = vec4 (ambient + diffuse + spec, transparency);
    }

    </script>

  <!--============================== LIBRARIES ==============================-->
  <!-- Matrix library and code for standard transformations -->
  <script type="text/javascript" src="./gl-matrix-min.js"></script>

  <!-- include the shape creation functions -->
  <script type="text/javascript" src="./cgIShape.js"></script>

  <!-- definition of standard shapes -->
  <script type="text/javascript" src="./myShapes-min.js"></script>

  <!-- include OBJ converter -->
  <script type="text/javascript" src="./OBJ.js"></script>  

  <!-- include custom OBJ/JS shapes -->
  <script type="text/javascript" src="./demo.js"></script>
  <script type="text/javascript" src="./Knight.js"></script>
  <script type="text/javascript" src="./Bench.js"></script>
  <script type="text/javascript" src="./Rain.js"></script>
  <script type="text/javascript" src="./Building.js"></script>

  <!-- include the main tesselation functions -->
  <script type="text/javascript" src="./textureMain.js"></script>

  <!-- texture images -->
  <img id="texDemo" src="Texture.png" style="display: none;"> </img>
  <img id="texKnight" src="Knight.png" style="display: none;"> </img>
  <img id="texBench" src="Bench.png" style="display: none;"> </img>
  <img id="texRain" src="Rain.png" style="display: none;"> </img>
  <img id="texBuilding" src="Building.png" style="display: none;"> </img>

  <!--========================= KEYBOARD FUNCTIONS ==========================-->
  <script type="text/javascript">
    function gotKey(event) {

      var key = event.key;

      // Do stuff conditionally based on what "key"'s value is.
      // if (key == 'a') {...}

      //draw();
    }
  </script>

  <!--================================ INIT =================================-->
  <script type="text/javascript">
    // Call init once the webpage has loaded
    window.onload = init;
  </script>
</head>

<!--================================ WEBPAGE ================================-->
<body>
  <canvas id="webgl-canvas" width="1280" height="720" style="background: red;">
    Your browser does not support the HTML5 canvas element.
  </canvas>
  <p>
    <audio controls loop>
      <source src="music.mp3" type="audio/mpeg">
      Your browser does not support the audio element.
    </audio>
    Play the music!
  </p>
  <img src="City.png" width="1280" height="720">
</body>

</html>